/**
 * GIFT - Geographical Islands FlexibiliTy
 * 
 * This project has received funding from 
 * the European Union's Horizon 2020 
 * research and innovation program under 
 * grant agreement No 824410.
 * 
 * Part of deliverable D3.10 GIS digital twin
 * 
 * NTNU - Norway
 * 
 * mdmsreactivepowergrytoya.js
 * ============================
 * 
 * Send request to esb
 * and make plot.
 * 
 * sverre.stikbakke@ntnu.no 19.04.2021
 */


"use strict";


GIFTWIN.esb.plot = GIFTWIN.esb.plot || {};


GIFTWIN.esb.plot.mdmsReActivePower = (() => {

    const createDialog = GIFTWIN.esb.createDialog;
    const createPlotFromDialog = GIFTWIN.esb.createPlotFromDialog;
    const addOkButtonEventListener = GIFTWIN.esb.addOkButtonEventListener;
    const get = GIFTWIN.esb.get;
    const removePlot = GIFTWIN.esb.removePlot;

    const getCurrentTime = GIFTWIN.esb.getCurrentTime;
    const convertToLocalTime = GIFTWIN.esb.convertToLocalTime;
    const showAsLocalTime = GIFTWIN.esb.showAsLocalTime;
    const toJSONTime = GIFTWIN.esb.toJSONTime;
    const yesterday = -2;
    const today = 0;
    const tomorrow = 0;

    const requestForm = `
 <form action="javascript:void(0)">
    <fieldset>
       <legend class="doc">MDMS - Reactive Power</legend>
       <div class="input-group">
          <label for="fromDate">From date</label>
          <input type="text" value='${showAsLocalTime(getCurrentTime(yesterday))}' class="fromDate"/>
       </div>
       <div class="input-group">
          <label for="toDate">To date</label>
          <input type="text" value='${showAsLocalTime(getCurrentTime(today))}' class="toDate"/>
       </div>
       <div class="input-group">
       <label for="meterId">Meter id</label>
       <input list="meterIdsMDMSreActivePower" class="meterId" placeholder="Select from list or edit"/>
       <datalist id="meterIdsMDMSreActivePower">
        <option value="FF2">
        <option value="PT500">
        <option value="707057500018778008">
        <option value="707057500018856904">
        <option value="707057500018857703">
        <option value="707057500018859721">
        <option value="707057500018864589">
        <option value="707057500018864596">
        <option value="707057500018953818">
        <option value="707057500018954037">
        <option value="707057500018956772">
        <option value="707057500018956789">
        <option value="707057500018956796">
        <option value="707057500018956802">
        <option value="707057500018957625">
        <option value="707057500018970396">
        <option value="707057500018970662">
        <option value="707057500018984195">
        <option value="707057500018990103">
        <option value="707057500018729932">
        <option value="707057500018736190">
        <option value="707057500018736718">
        <option value="707057500018738781">
        <option value="707057500018745468">
        <option value="707057500018746106">
        <option value="707057500018746625">
        <option value="707057500018746861">
        <option value="707057500018758888">
        <option value="707057500018760058">
        <option value="707057500018767767">
        <option value="707057500018782036">
        <option value="707057500018802079">
        <option value="707057500018802765">
        <option value="707057500018802772">
        <option value="707057500018802802">
        <option value="707057500018803878">
        <option value="707057500018804905">
        <option value="707057500018807029">
        <option value="707057500018810609">
        <option value="707057500018813853">
        <option value="707057500018814232">
        <option value="707057500018816786">
        <option value="707057500018817066">
        <option value="707057500018818605">
        <option value="707057500018818759">
        <option value="707057500018827522">
        <option value="707057500018836210">
        <option value="707057500018872546">
        <option value="707057500018872706">
        <option value="707057500018874410">
        <option value="707057500018913478">
        <option value="707057500018913928">
        <option value="707057500018917070">
        <option value="707057500018917087">
        <option value="707057500018917773">
        <option value="707057500018918398">
        <option value="707057500018918657">
        <option value="707057500018920070">
        <option value="707057500018920148">
        <option value="707057500018920407">
        <option value="707057500018923491">
        <option value="707057500018933513">
        <option value="707057500018969505">
        <option value="707057500018997317">
        <option value="707057500019008654">
        <option value="707057500018952699">
        <option value="707057500018964531">
        <option value="707057500018707282">
        <option value="707057500018750820">
        <option value="707057500018763981">
        <option value="707057500018767248">
        <option value="707057500018768771">
        <option value="707057500018800273">
        <option value="707057500018800297">
        <option value="707057500018807494">
        <option value="707057500018810814">
        <option value="707057500018812139">
        <option value="707057500018813518">
        <option value="707057500018843607">
        <option value="707057500018843706">
        <option value="707057500018945967">
        <option value="707057500018986694">
        <option value="707057500019001648">
        <option value="707057500019007107">
        <option value="707057500019008906">
        <option value="707057500018767484">
        <option value="707057500018713160">
        <option value="707057500018803670">
        <option value="707057500018803687">
        <option value="707057500018809962">
        <option value="707057500018818421">
        <option value="707057500018845038">
        <option value="707057500018863933">
        <option value="707057500018864916">
        <option value="707057500018865029">
        <option value="707057500018865562">
        <option value="707057500018945868">
        <option value="707057500018944403">
        <option value="707057500018998550">
        <option value="707057500018708258">
        <option value="707057500018737067">
        <option value="707057500018759038">
        <option value="707057500018763240">
        <option value="707057500018763905">
        <option value="707057500018767231">
        <option value="707057500018808866">
        <option value="707057500018860918">
        <option value="707057500018864305">
        <option value="707057500018864480">
        <option value="707057500018914161">
        <option value="707057500018917766">
        <option value="707057500019002348">
        <option value="707057500018709996">
        <option value="707057500018710671">
        <option value="707057500018713009">
        <option value="707057500018730860">
        <option value="707057500018732727">
        <option value="707057500018746458">
        <option value="707057500018753692">
        <option value="707057500018771375">
        <option value="707057500018791106">
        <option value="707057500018797627">
        <option value="707057500018797870">
        <option value="707057500018807098">
        <option value="707057500018807487">
        <option value="707057500018808781">
        <option value="707057500018814942">
        <option value="707057500018816670">
        <option value="707057500018827829">
        <option value="707057500018840576">
        <option value="707057500018844871">
        <option value="707057500018849562">
        <option value="707057500018851534">
        <option value="707057500018917056">
        <option value="707057500018918237">
        <option value="707057500018918329">
        <option value="707057500018986373">
        <option value="707057500018987387">
        <option value="707057500018786805">
        <option value="707057500018739351">
        <option value="707057500018764032">
        <option value="707057500018766654">
        <option value="707057500018776967">
        <option value="707057500018792691">
        <option value="707057500018803403">
        <option value="707057500018811897">
        <option value="707057500018833202">
        <option value="707057500018833271">
        <option value="707057500018844253">
        <option value="707057500018844314">
        <option value="707057500018862073">
        <option value="707057500018868839">
        <option value="707057500018870177">
        <option value="707057500018916073">
        <option value="707057500018916271">
        <option value="707057500018916486">
        <option value="707057500018949651">
        <option value="707057500018982344">
        <option value="707057500018739429">
        <option value="707057500018756105">
        <option value="707057500018756976">
        <option value="707057500018757782">
        <option value="707057500018758567">
        <option value="707057500018759281">
        <option value="707057500018766272">
        <option value="707057500018785570">
        <option value="707057500018829809">
        <option value="707057500018835299">
        <option value="707057500018835923">
        <option value="707057500018841269">
        <option value="707057500018842815">
        <option value="707057500018849609">
        <option value="707057500018860222">
        <option value="707057500018872195">
        <option value="707057500018915403">
        <option value="707057500018915885">
        <option value="707057500018916875">
        <option value="707057500018977111">
        <option value="707057500018979672">
        <option value="707057500018982337">
        <option value="707057500018713214">
        <option value="707057500018723954">
        <option value="707057500018734394">
        <option value="707057500018745635">
        <option value="707057500018761628">
        <option value="707057500018769761">
        <option value="707057500018800051">
        <option value="707057500018800068">
        <option value="707057500018816946">
        <option value="707057500018966672">
        <option value="707057500018977555">
        <option value="707057500018982351">
        <option value="707057500018791397">
        <option value="707057500018716093">
        <option value="707057500018735629">
        <option value="707057500018735759">
        <option value="707057500018737579">
        <option value="707057500018771450">
        <option value="707057500018779050">
        <option value="707057500018800884">
        <option value="707057500018803410">
        <option value="707057500018803809">
        <option value="707057500018809528">
        <option value="707057500018810555">
        <option value="707057500018817240">
        <option value="707057500018835367">
        <option value="707057500018866415">
        <option value="707057500018873338">
        <option value="707057500018917964">
        <option value="707057500018998451">
        <option value="707057500018709187">
        <option value="707057500018717298">
        <option value="707057500018718998">
        <option value="707057500018766074">
        <option value="707057500018769051">
        <option value="707057500018774413">
        <option value="707057500018780858">
        <option value="707057500018803656">
        <option value="707057500018803731">
        <option value="707057500018805513">
        <option value="707057500018807036">
        <option value="707057500018809474">
        <option value="707057500018812023">
        <option value="707057500018816267">
        <option value="707057500018818001">
        <option value="707057500018844567">
        <option value="707057500018934923">
        <option value="707057500018936101">
        <option value="707057500018936200">
        <option value="707057500018986366">
        <option value="707057500018817295">
        <option value="707057500018705189">
        <option value="707057500018711432">
        <option value="707057500018747240">
        <option value="707057500018755153">
        <option value="707057500018766111">
        <option value="707057500018774482">
        <option value="707057500018778947">
        <option value="707057500018798556">
        <option value="707057500018800891">
        <option value="707057500018816212">
        <option value="707057500018897952">
        <option value="707057500018924108">
        <option value="707057500018924207">
        <option value="707057500018712095">
        <option value="707057500018712101">
        <option value="707057500018712118">
        <option value="707057500018712125">
        <option value="707057500018719001">
        <option value="707057500018733458">
        <option value="707057500018739047">
        <option value="707057500018739962">
        <option value="707057500018749824">
        <option value="707057500018751032">
        <option value="707057500018756952">
        <option value="707057500018773126">
        <option value="707057500018781015">
        <option value="707057500018798754">
        <option value="707057500018798907">
        <option value="707057500018807944">
        <option value="707057500018811248">
        <option value="707057500018816250">
        <option value="707057500018816274">
        <option value="707057500018818346">
        <option value="707057500018818438">
        <option value="707057500018836425">
        <option value="707057500018916899">
        <option value="707057500018970716">
        <option value="707057500018979979">
        <option value="707057500018982405">
        <option value="707057500018999342">
        <option value="707057500019014099">
        <option value="707057500019007725">
        <option value="707057500018722858">
        <option value="707057500018740470">
        <option value="707057500018788236">
        <option value="707057500018799300">
        <option value="707057500018818728">
        <option value="707057500018824880">
        <option value="707057500018981781">
        <option value="707057500018981835">
        <option value="707057500018986304">
        <option value="707057500018706056">
        <option value="707057500018763332">
        <option value="707057500018803557">
        <option value="707057500018803915">
        <option value="707057500018817134">
        <option value="707057500018817288">
        <option value="707057500018819084">
        <option value="707057500018819091">
        <option value="707057500018821780">
        <option value="707057500018829427">
        <option value="707057500018829724">
        <option value="707057500018844888">
        <option value="707057500018849890">
        <option value="707057500018872966">
        <option value="707057500018873222">
        <option value="707057500018907262">
        <option value="707057500018913652">
        <option value="707057500018914888">
        <option value="707057500018936941">
        <option value="707057500018962315">
        <option value="707057500018962957">
        <option value="707057500018962964">
        <option value="707057500018963367">
        <option value="707057500018963374">
        <option value="707057500018963381">
        <option value="707057500018963398">
        <option value="707057500018963404">
        <option value="707057500018963411">
        <option value="707057500018963428">
        <option value="707057500018963435">
        <option value="707057500018963442">
        <option value="707057500018963459">
        <option value="707057500018982399">
        <option value="707057500018984201">
        <option value="707057500018994194">
        <option value="707057500018717656">
        <option value="707057500018718981">
        <option value="707057500018736855">
        <option value="707057500018750455">
        <option value="707057500018750844">
        <option value="707057500018775670">
        <option value="707057500018806459">
        <option value="707057500018818377">
        <option value="707057500018819183">
        <option value="707057500018820219">
        <option value="707057500018848206">
        <option value="707057500018805421">
        <option value="707057500018717335">
        <option value="707057500018728010">
        <option value="707057500018728508">
        <option value="707057500018731805">
        <option value="707057500018742764">
        <option value="707057500018745178">
        <option value="707057500018745185">
        <option value="707057500018745222">
        <option value="707057500018745239">
        <option value="707057500018745284">
        <option value="707057500018745321">
        <option value="707057500018745376">
        <option value="707057500018746021">
        <option value="707057500018750394">
        <option value="707057500018753104">
        <option value="707057500018754002">
        <option value="707057500018770583">
        <option value="707057500018786041">
        <option value="707057500018786065">
        <option value="707057500018791076">
        <option value="707057500018807500">
        <option value="707057500018860994">
        <option value="707057500018861007">
        <option value="707057500018947800">
        <option value="707057500018979962">
        <option value="707057500018992916">
        <option value="707057500018729413">
        <option value="707057500018729536">
        <option value="707057500018737968">
        <option value="707057500018755887">
        <option value="707057500018766135">
        <option value="707057500018791359">
        <option value="707057500018798419">
        <option value="707057500018798433">
        <option value="707057500018798549">
        <option value="707057500018807210">
        <option value="707057500018807685">
        <option value="707057500018810777">
        <option value="707057500018817592">
        <option value="707057500018818902">
        <option value="707057500018819466">
        <option value="707057500018821797">
        <option value="707057500018837422">
        <option value="707057500018838726">
        <option value="707057500018842365">
        <option value="707057500018849098">
        <option value="707057500018849586">
        <option value="707057500018866729">
        <option value="707057500018874960">
        <option value="707057500018913942">
        <option value="707057500018915427">
        <option value="707057500018931526">
        <option value="707057500018945509">
        <option value="707057500018958042">
        <option value="707057500018960960">
        <option value="707057500018978880">
        <option value="707057500018982153">
        <option value="707057500018982375">
        <option value="707057500018990707">
        <option value="707057500019001655">
        <option value="707057500018763172">
        <option value="707057500018764346">
        <option value="707057500018766197">
        <option value="707057500018766692">
        <option value="707057500018769181">
        <option value="707057500018769198">
        <option value="707057500018769204">
        <option value="707057500018791694">
        <option value="707057500018861014">
        <option value="707057500018861021">
        <option value="707057500018946636">
        <option value="707057500018744157">
        <option value="707057500018750684">
        <option value="707057500018758000">
        <option value="707057500018759083">
        <option value="707057500018798693">
        <option value="707057500018805629">
        <option value="707057500018806053">
        <option value="707057500018813112">
        <option value="707057500018817332">
        <option value="707057500018818117">
        <option value="707057500018818247">
        <option value="707057500018840385">
        <option value="707057500018844307">
        <option value="707057500018844895">
        <option value="707057500018849234">
        <option value="707057500018872256">
        <option value="707057500018900089">
        <option value="707057500018901338">
        <option value="707057500018914499">
        <option value="707057500018915410">
        <option value="707057500018920308">
        <option value="707057500018975148">
        <option value="707057500018992923">
        <option value="707057500018705042">
        <option value="707057500018712071">
        <option value="707057500018712491">
        <option value="707057500018730310">
        <option value="707057500018750721">
        <option value="707057500018751704">
        <option value="707057500018767408">
        <option value="707057500018777971">
        <option value="707057500018801560">
        <option value="707057500018817127">
        <option value="707057500018845687">
        <option value="707057500018874601">
        <option value="707057500018923385">
        <option value="707057500018949132">
        <option value="707057500018986380">
        <option value="707057500018918213">
        <option value="707057500018767002">
        <option value="707057500018778077">
        <option value="707057500018801621">
        <option value="707057500018801638">
        <option value="707057500018802987">
        <option value="707057500018805490">
        <option value="707057500018807159">
        <option value="707057500018812610">
        <option value="707057500018812627">
        <option value="707057500018813433">
        <option value="707057500018844321">
        <option value="707057500018916776">
        <option value="707057500018986311">
        <option value="707057500018986397">
        <option value="707057500018959353">
        <option value="707057500018772518">
        <option value="707057500018807661">
        <option value="707057500018844826">
        <option value="707057500018919753">
        <option value="707057500018944649">
        <option value="707057500018986403">
        <option value="707057500018913737">
        <option value="707057500018717397">
        <option value="707057500018720595">
        <option value="707057500018720670">
        <option value="707057500018729024">
        <option value="707057500018747172">
        <option value="707057500018768856">
        <option value="707057500018822220">
        <option value="707057500018839884">
        <option value="707057500018847735">
        <option value="707057500018914543">
        <option value="707057500018982368">
        <option value="707057500018754682">
        <option value="707057500019007756">
        <option value="707057500019002003">
        <option value="707057500019001877">
        <option value="707057500019001990">
        <option value="707057500018706377">
        <option value="707057500018707121">
        <option value="707057500018711258">
        <option value="707057500018721899">
        <option value="707057500018726023">
        <option value="707057500018730501">
        <option value="707057500018730655">
        <option value="707057500018746960">
        <option value="707057500018751179">
        <option value="707057500018752787">
        <option value="707057500018806442">
        <option value="707057500018808637">
        <option value="707057500018808651">
        <option value="707057500018811873">
        <option value="707057500018818193">
        <option value="707057500018818223">
        <option value="707057500018819268">
        <option value="707057500018819473">
        <option value="707057500018819480">
        <option value="707057500018819497">
        <option value="707057500018833080">
        <option value="707057500018860833">
        <option value="707057500018872355">
        <option value="707057500018925020">
        <option value="707057500018984447">
        <option value="707057500018984485">
        <option value="707057500019002263">
        <option value="707057500019008593">
        <option value="707057500019011548">
        <option value="707057500018826730">
        <option value="707057500018703192">
        <option value="707057500018709668">
        <option value="707057500018712989">
        <option value="707057500018731898">
        <option value="707057500018738347">
        <option value="707057500018742511">
        <option value="707057500018747738">
        <option value="707057500018775380">
        <option value="707057500018775441">
        <option value="707057500018797252">
        <option value="707057500018806435">
        <option value="707057500018806466">
        <option value="707057500018806473">
        <option value="707057500018813891">
        <option value="707057500018813914">
        <option value="707057500018815550">
        <option value="707057500018816380">
        <option value="707057500018847858">
        <option value="707057500018847933">
        <option value="707057500018919074">
        <option value="707057500018945851">
        <option value="707057500018971263">
        <option value="707057500018978668">
        <option value="707057500018984768">
        <option value="707057500018997379">
        <option value="707057500018835824">
        <option value="707057500018714747">
        <option value="707057500018729567">
        <option value="707057500018759519">
        <option value="707057500018764827">
        <option value="707057500018772921">
        <option value="707057500018787895">
        <option value="707057500018788298">
        <option value="707057500018794244">
        <option value="707057500018799959">
        <option value="707057500018833882">
        <option value="707057500018833899">
        <option value="707057500018845045">
        <option value="707057500018917452">
        <option value="707057500018987745">
        <option value="707057500018996877">
        <option value="707057500018764469">
        <option value="707057500018730280">
        <option value="707057500018739993">
        <option value="707057500018761888">
        <option value="707057500018767378">
        <option value="707057500018767453">
        <option value="707057500018798129">
        <option value="707057500018799690">
        <option value="707057500018819459">
        <option value="707057500018844369">
        <option value="707057500018870863">
        <option value="707057500018984515">
        <option value="707057500018846110">
        <option value="707057500018740890">
        <option value="707057500018863698">
        <option value="707057500018707459">
        <option value="707057500018711630">
        <option value="707057500018753609">
        <option value="707057500018772686">
        <option value="707057500018791120">
        <option value="707057500018809122">
        <option value="707057500018809870">
        <option value="707057500018812030">
        <option value="707057500018813990">
        <option value="707057500018817622">
        <option value="707057500018820448">
        <option value="707057500018834988">
        <option value="707057500018835695">
        <option value="707057500018848169">
        <option value="707057500018860543">
        <option value="707057500018873758">
        <option value="707057500018966337">
        <option value="707057500018853835">
        <option value="707057500018772808">
        <option value="707057500018711487">
        <option value="707057500018727266">
        <option value="707057500018802215">
        <option value="707057500018817615">
        <option value="707057500018849708">
        <option value="707057500018944656">
        <option value="707057500018716697">
        <option value="707057500018727457">
        <option value="707057500018739061">
        <option value="707057500018743457">
        <option value="707057500018759052">
        <option value="707057500018768283">
        <option value="707057500018797139">
        <option value="707057500018798884">
        <option value="707057500018817646">
        <option value="707057500018818216">
        <option value="707057500018869249">
        <option value="707057500018921329">
        <option value="707057500018937436">
        <option value="707057500018984775">
        <option value="707057500018705257">
        <option value="707057500018743044">
        <option value="707057500018753449">
        <option value="707057500018770620">
        <option value="707057500018797245">
        <option value="707057500018800143">
        <option value="707057500018848220">
        <option value="707057500018870429">
        <option value="707057500018874632">
        <option value="707057500018920667">
        <option value="707057500018920841">
        <option value="707057500018984492">
        <option value="707057500019001778">
        <option value="707057500018729673">
        <option value="707057500018741590">
        <option value="707057500018805001">
        <option value="707057500018810975">
        <option value="707057500018811187">
        <option value="707057500018917049">
        <option value="707057500018917377">
        <option value="707057500018934442">
        <option value="707057500018962346">
        <option value="707057500018734172">
        <option value="707057500019008944">
        <option value="707057500019001860">
        <option value="707057500018755672">
        <option value="707057500018755702">
        <option value="707057500018717618">
        <option value="707057500018704861">
        <option value="707057500018704946">
        <option value="707057500018725736">
        <option value="707057500018728867">
        <option value="707057500018751926">
        <option value="707057500018753340">
        <option value="707057500018761291">
        <option value="707057500018778619">
        <option value="707057500018783286">
        <option value="707057500018788434">
        <option value="707057500018803694">
        <option value="707057500018803854">
        <option value="707057500018812375">
        <option value="707057500018813327">
        <option value="707057500018814102">
        <option value="707057500018817264">
        <option value="707057500018817721">
        <option value="707057500018822831">
        <option value="707057500018841061">
        <option value="707057500018866422">
        <option value="707057500018869041">
        <option value="707057500018979573">
        <option value="707057500018983235">
        <option value="707057500018984522">
        <option value="707057500018984539">
        <option value="707057500018991322">
        <option value="707057500018869515">
        <option value="707057500018744188">
        <option value="707057500018769419">
        <option value="707057500018789431">
        <option value="707057500018839921">
        <option value="707057500018864961">
        <option value="707057500018954518">
        <option value="707057500018968218">
        <option value="707057500018988889">
        <option value="707057500018943888">
        <option value="707057500018741453">
        <option value="707057500018778206">
        <option value="707057500018779241">
        <option value="707057500018780834">
        <option value="707057500018783569">
        <option value="707057500018808569">
        <option value="707057500018811767">
        <option value="707057500018818230">
        <option value="707057500018956987">
        <option value="707057500018979566">
        <option value="707057500018997645">
        <option value="707057500018744294">
        <option value="707057500018724425">
        <option value="707057500018761116">
        <option value="707057500018918701">
        <option value="707057500018919500">
        <option value="707057500018993050">
        <option value="707057500018822503">
        <option value="707057500018787789">
        <option value="707057500018798402">
        <option value="707057500018806411">
        <option value="707057500018853910">
        <option value="707057500018867030">
        <option value="707057500018996655">
        <option value="707057500018746250">
        <option value="707057500018787260">
        <option value="707057500018824057">
        <option value="707057500018825054">
        <option value="707057500018832748">
        <option value="707057500018731959">
        <option value="707057500018726771">
        <option value="707057500018727471">
        <option value="707057500018729901">
        <option value="707057500018745062">
        <option value="707057500018755214">
        <option value="707057500018761765">
        <option value="707057500018768665">
        <option value="707057500018788373">
        <option value="707057500018813235">
        <option value="707057500018813310">
        <option value="707057500018817875">
        <option value="707057500018821285">
        <option value="707057500018829403">
        <option value="707057500018867832">
        <option value="707057500018982894">
        <option value="707057500018993241">
        <option value="707057500018746816">
        <option value="707057500018706025">
        <option value="707057500018708050">
        <option value="707057500018710565">
        <option value="707057500018739986">
        <option value="707057500018741194">
        <option value="707057500018746809">
        <option value="707057500018771894">
        <option value="707057500018808828">
        <option value="707057500018809627">
        <option value="707057500018815949">
        <option value="707057500018848879">
        <option value="707057500018849265">
        <option value="707057500018874182">
        <option value="707057500018928236">
        <option value="707057500018732635">
        <option value="707057500018745406">
        <option value="707057500018814737">
        <option value="707057500018823074">
        <option value="707057500018969703">
        <option value="707057500019003932">
        <option value="707057500018711548">
        <option value="707057500018714518">
        <option value="707057500018737135">
        <option value="707057500018741163">
        <option value="707057500018746397">
        <option value="707057500018760157">
        <option value="707057500018760362">
        <option value="707057500018760621">
        <option value="707057500018760874">
        <option value="707057500018761666">
        <option value="707057500018784368">
        <option value="707057500018795272">
        <option value="707057500018796514">
        <option value="707057500018796811">
        <option value="707057500018798358">
        <option value="707057500018807203">
        <option value="707057500018807531">
        <option value="707057500018807845">
        <option value="707057500018808149">
        <option value="707057500018810241">
        <option value="707057500018815536">
        <option value="707057500018815543">
        <option value="707057500018818452">
        <option value="707057500018818469">
        <option value="707057500018832014">
        <option value="707057500018861120">
        <option value="707057500018864640">
        <option value="707057500018943598">
        <option value="707057500018962278">
        <option value="707057500018967723">
        <option value="707057500018974134">
        <option value="707057500018979375">
        <option value="707057500018992268">
        <option value="707057500018747059">
        <option value="707057500018710886">
        <option value="707057500018711289">
        <option value="707057500018711913">
        <option value="707057500018737203">
        <option value="707057500018744546">
        <option value="707057500018750417">
        <option value="707057500018753371">
        <option value="707057500018759823">
        <option value="707057500018761864">
        <option value="707057500018769013">
        <option value="707057500018772365">
        <option value="707057500018776547">
        <option value="707057500018776622">
        <option value="707057500018776974">
        <option value="707057500018780360">
        <option value="707057500018782043">
        <option value="707057500018793223">
        <option value="707057500018796859">
        <option value="707057500018796965">
        <option value="707057500018797221">
        <option value="707057500018801980">
        <option value="707057500018809405">
        <option value="707057500018809443">
        <option value="707057500018812085">
        <option value="707057500018820820">
        <option value="707057500018848510">
        <option value="707057500018850384">
        <option value="707057500018933896">
        <option value="707057500018992664">
        <option value="707057500018801652">
        <option value="707057500018727006">
        <option value="707057500018730419">
        <option value="707057500018793322">
        <option value="707057500018803892">
        <option value="707057500018808460">
        <option value="707057500018809429">
        <option value="707057500018809450">
        <option value="707057500018875165">
        <option value="707057500018878074">
        <option value="707057500018979955">
        <option value="707057500018719353">
        <option value="707057500018711043">
        <option value="707057500018802741">
        <option value="707057500018709767">
        <option value="707057500018768276">
        <option value="707057500018796255">
        <option value="707057500018822251">
        <option value="707057500018824804">
        <option value="707057500018825221">
        <option value="707057500018825238">
        <option value="707057500018825245">
        <option value="707057500018845885">
        <option value="707057500018854221">
        <option value="707057500018854290">
        <option value="707057500018867924">
        <option value="707057500018869102">
        <option value="707057500018870702">
        <option value="707057500018963947">
        <option value="707057500018996181">
        <option value="707057500018915465">
        <option value="707057500018719179">
        <option value="707057500018719469">
        <option value="707057500018751094">
        <option value="707057500018756679">
        <option value="707057500018760836">
        <option value="707057500018762076">
        <option value="707057500018811682">
        <option value="707057500018812689">
        <option value="707057500018817707">
        <option value="707057500018827317">
        <option value="707057500018841511">
        <option value="707057500018904384">
        <option value="707057500018905770">
        <option value="707057500018949125">
        <option value="707057500018803489">
        <option value="707057500018706285">
        <option value="707057500018709019">
        <option value="707057500018712026">
        <option value="707057500018719162">
        <option value="707057500018743433">
        <option value="707057500018744027">
        <option value="707057500018747523">
        <option value="707057500018761598">
        <option value="707057500018790697">
        <option value="707057500018801850">
        <option value="707057500018808552">
        <option value="707057500018815383">
        <option value="707057500018841979">
        <option value="707057500018914147">
        <option value="707057500018918541">
        <option value="707057500018969604">
        <option value="707057500018992497">
        <option value="707057500018917650">
        <option value="707057500018717861">
        <option value="707057500018737654">
        <option value="707057500018741262">
        <option value="707057500018741279">
        <option value="707057500018742160">
        <option value="707057500018742177">
        <option value="707057500018742184">
        <option value="707057500018742191">
        <option value="707057500018742207">
        <option value="707057500018742214">
        <option value="707057500018742221">
        <option value="707057500018742559">
        <option value="707057500018743013">
        <option value="707057500018757683">
        <option value="707057500018793285">
        <option value="707057500018806817">
        <option value="707057500018814621">
        <option value="707057500018814799">
        <option value="707057500018824798">
        <option value="707057500018833097">
        <option value="707057500018836432">
        <option value="707057500018847056">
        <option value="707057500018847391">
        <option value="707057500018858304">
        <option value="707057500018915748">
        <option value="707057500018945769">
        <option value="707057500018997430">
        <option value="707057500018997454">
        <option value="707057500018813709">
        <option value="707057500018727785">
        <option value="707057500018741743">
        <option value="707057500018756358">
        <option value="707057500018786522">
        <option value="707057500018796064">
        <option value="707057500018803588">
        <option value="707057500018816441">
        <option value="707057500018969932">
        <option value="707057500018963930">
        <option value="707057500018708654">
        <option value="707057500018739160">
        <option value="707057500018748988">
        <option value="707057500018764971">
        <option value="707057500018766128">
        <option value="707057500018781602">
        <option value="707057500018790222">
        <option value="707057500018799799">
        <option value="707057500018811293">
        <option value="707057500018917520">
        <option value="707057500018928762">
        <option value="707057500018958530">
        <option value="707057500018993234">
        <option value="707057500018712392">
        <option value="707057500018719223">
        <option value="707057500018720267">
        <option value="707057500018732932">
        <option value="707057500018748308">
        <option value="707057500018756112">
        <option value="707057500018774659">
        <option value="707057500018794985">
        <option value="707057500018807678">
        <option value="707057500018808644">
        <option value="707057500018812917">
        <option value="707057500018814072">
        <option value="707057500018869416">
        <option value="707057500018966788">
        <option value="707057500018975643">
        <option value="707057500018993067">
        <option value="707057500018859929">
        <option value="707057500018742894">
        <option value="707057500018756198">
        <option value="707057500018756921">
        <option value="707057500018769334">
        <option value="707057500018807180">
        <option value="707057500018824064">
        <option value="707057500018832793">
        <option value="707057500018836814">
        <option value="707057500018918473">
        <option value="707057500018929509">
        <option value="707057500018959230">
        <option value="707057500018962360">
        <option value="707057500018779975">
        <option value="707057500018781282">
        <option value="707057500018781817">
        <option value="707057500018782111">
        <option value="707057500018784443">
        <option value="707057500018784962">
        <option value="707057500018788588">
        <option value="707057500018824217">
        <option value="707057500018983174">
        <option value="707057500018781558">
        <option value="707057500018705516">
        <option value="707057500018752534">
        <option value="707057500018803014">
        <option value="707057500018809993">
        <option value="707057500018824378">
        <option value="707057500018841603">
        <option value="707057500018854061">
        <option value="707057500018857239">
        <option value="707057500018915243">
        <option value="707057500018992671">
        <option value="707057500018760409">
        <option value="707057500018721165">
        <option value="707057500018753050">
        <option value="707057500018799836">
        <option value="707057500018814638">
        <option value="707057500018814676">
        <option value="707057500018814829">
        <option value="707057500018842082">
        <option value="707057500018842181">
        <option value="707057500018918138">
        <option value="707057500018973557">
        <option value="707057500018993180">
        <option value="707057500018915564">
        <option value="707057500018744485">
        <option value="707057500018704137">
        <option value="707057500018743716">
        <option value="707057500018777933">
        <option value="707057500018799379">
        <option value="707057500018799423">
        <option value="707057500018799713">
        <option value="707057500018805568">
        <option value="707057500018807135">
        <option value="707057500018807296">
        <option value="707057500018808255">
        <option value="707057500018811361">
        <option value="707057500018811415">
        <option value="707057500018814782">
        <option value="707057500018820288">
        <option value="707057500018835947">
        <option value="707057500018846929">
        <option value="707057500018875769">
        <option value="707057500018876339">
        <option value="707057500018989923">
        <option value="707057500019005356">
        <option value="707057500018980753">
        <option value="707057500018980760">
        <option value="707057500018786959">
        <option value="707057500018732703">
        <option value="707057500018733564">
        <option value="707057500018743372">
        <option value="707057500018771849">
        <option value="707057500018799034">
        <option value="707057500018801997">
        <option value="707057500018804394">
        <option value="707057500018805698">
        <option value="707057500018807548">
        <option value="707057500018808347">
        <option value="707057500018808859">
        <option value="707057500018808873">
        <option value="707057500018808897">
        <option value="707057500018810289">
        <option value="707057500018811460">
        <option value="707057500018812290">
        <option value="707057500018817479">
        <option value="707057500018838979">
        <option value="707057500018839686">
        <option value="707057500018840491">
        <option value="707057500018844437">
        <option value="707057500018844475">
        <option value="707057500018919357">
        <option value="707057500018919586">
        <option value="707057500018982207">
        <option value="707057500019002416">
        <option value="707057500018711463">
        <option value="707057500018709323">
        <option value="707057500018724531">
        <option value="707057500018727679">
        <option value="707057500018789622">
        <option value="707057500018804646">
        <option value="707057500018806541">
        <option value="707057500018807753">
        <option value="707057500018826716">
        <option value="707057500018847384">
        <option value="707057500018711753">
        <option value="707057500018715485">
        <option value="707057500018723619">
        <option value="707057500018728614">
        <option value="707057500018746427">
        <option value="707057500018796927">
        <option value="707057500018799751">
        <option value="707057500018801737">
        <option value="707057500018802048">
        <option value="707057500018802598">
        <option value="707057500018844468">
        <option value="707057500018847063">
        <option value="707057500018847377">
        <option value="707057500018872515">
        <option value="707057500018915700">
        <option value="707057500018915922">
        <option value="707057500018982221">
        <option value="707057500018997256">
        <option value="707057500019013702">
        <option value="707057500019013000">
        <option value="707057500018762052">
        <option value="707057500018710534">
        <option value="707057500018723282">
        <option value="707057500018750318">
        <option value="707057500018757386">
        <option value="707057500018776080">
        <option value="707057500018796767">
        <option value="707057500018796972">
        <option value="707057500018801072">
        <option value="707057500018803748">
        <option value="707057500018805278">
        <option value="707057500018807050">
        <option value="707057500018807630">
        <option value="707057500018812429">
        <option value="707057500018839877">
        <option value="707057500018844451">
        <option value="707057500018847636">
        <option value="707057500018991230">
        <option value="707057500018810135">
        <option value="707057500018736725">
        <option value="707057500018737661">
        <option value="707057500018737777">
        <option value="707057500018742115">
        <option value="707057500018743167">
        <option value="707057500018755788">
        <option value="707057500018758314">
        <option value="707057500018758635">
        <option value="707057500018776370">
        <option value="707057500018789394">
        <option value="707057500018793667">
        <option value="707057500018796774">
        <option value="707057500018797061">
        <option value="707057500018797092">
        <option value="707057500018799355">
        <option value="707057500018805049">
        <option value="707057500018805186">
        <option value="707057500018805322">
        <option value="707057500018805599">
        <option value="707057500018806664">
        <option value="707057500018806695">
        <option value="707057500018807883">
        <option value="707057500018807890">
        <option value="707057500018809535">
        <option value="707057500018810111">
        <option value="707057500018810128">
        <option value="707057500018810159">
        <option value="707057500018813341">
        <option value="707057500018814614">
        <option value="707057500018814775">
        <option value="707057500018814812">
        <option value="707057500018819329">
        <option value="707057500018820578">
        <option value="707057500018837149">
        <option value="707057500018843270">
        <option value="707057500018875103">
        <option value="707057500018915984">
        <option value="707057500018933360">
        <option value="707057500018982214">
        <option value="707057500018982801">
        <option value="707057500018987912">
        <option value="707057500018993074">
        <option value="707057500018992251">
        <option value="707057500018796804">
        <option value="707057500018711449">
        <option value="707057500018723756">
        <option value="707057500018734035">
        <option value="707057500018766746">
        <option value="707057500018777575">
        <option value="707057500018786010">
        <option value="707057500018799577">
        <option value="707057500018801232">
        <option value="707057500018801386">
        <option value="707057500018801461">
        <option value="707057500018824637">
        <option value="707057500018828833">
        <option value="707057500018842624">
        <option value="707057500018847445">
        <option value="707057500018857710">
        <option value="707057500018861663">
        <option value="707057500018864275">
        <option value="707057500018916981">
        <option value="707057500018929080">
        <option value="707057500018977449">
        <option value="707057500018979412">
        <option value="707057500018982306">
        <option value="707057500018987738">
        <option value="707057500018992619">
        <option value="707057500018846165">
        <option value="707057500018846127">
        <option value="707057500018846134">
        <option value="707057500018975612">
        <option value="707057500018869256">
        <option value="707057500018997485">
        <option value="707057500019005677">
    </datalist>
    </div>
       <button class="ok-button">OK</button>
    </fieldset>
 </form>`;


    const submitRequestForm = async (section, layer, fetchRequestFunction) => {

        const fromDate = section.querySelector(".fromDate").value;
        const toDate = section.querySelector(".toDate").value;
        const meterId = section.querySelector(".meterId").value;
        const esbQuery = `/MDMS/`
            + `?fromDate=${toJSONTime(fromDate)}`           // 2021-02-01T00:00:00Z
            + `&measurementKind=reactivePower`
            + `&meterIdList=${meterId}`
            + `&regionName=Grytoya`
            + `&toDate=${toJSONTime(toDate)}`;              // 2021-02-02T00:00:00Z
        console.log(esbQuery);
        const plotData = await fetchRequestFunction(layer, esbQuery);
        if (plotData) {
            createPlotFromDialog(layer, plotData);
        };
    };


    const fetchRequest = async (layer, esbQuery) => {

        const data = await get(layer, esbQuery);
        if (!data) {
            removePlot(layer);
            return false;
        };

        const rows = data       // rows is an array of JSON objects
        [layer.jsonLevel_1]
        [layer.jsonLevel_2]
        [layer.jsonLevel_3];

        const unpack = (rows, key) => rows.map(row => row[key]);

        let x = unpack(rows, "timestamp");
        let y = unpack(rows, "value");
        x = convertToLocalTime(x);

        const plotData = {
            traces: [{
                type: "scattergl",
                mode: "lines",
                x: x,
                y: y,
                line: { color: "#17BECF" }
            }],
            layout: {
                "title": "Reactive Power [kvar]",
                "xaxis": { "tickangle": -45, "automargin": true }
            }
        };

        return plotData;
    };


    const preparePlot = (layer) => {

        const section = createDialog(layer, requestForm);

        addOkButtonEventListener(
            section,
            layer,
            submitRequestForm,
            fetchRequest
        );
    };


    return preparePlot;
})();
